<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Hypergeometric</title><style type="text/css">body{
margin:40px auto;
max-width:650px;
line-height:1.6;
font-size:18px;
color:#eee;
background-color:#111;
padding:0 10px
}
textarea, input, button {
color:#eee;
background-color:#111;
}
button:hover {
  background-color:#222;
}
</style>
  <script type="text/javascript" src="vis-graph3d.min.js"></script>
  <script type="text/javascript" src="hypergeometric.js"></script>
</head>

<body>
  <div id="root"></div>
</body>

<script type="text/javascript">
  let root = null;

  const tempGlobal = {
    data: null,
    graph: null,
  };
  const renderGraph = ({rows, yMax}) => {
    //
    // Render graph
    //

    // Create and populate a data table.
    const data = new vis.DataSet();

    var counter = 0;
    for (var i = 0; i < rows.length; i+=1) {
      const {successesInPop, observedSuccesses, probability} = rows[i];
      const value = observedSuccesses/yMax;
      data.add({
        id: counter++,
        x: successesInPop,
        y: observedSuccesses,
        z: probability,
        style: value,
      });
    }

    if (!tempGlobal.data) {
      tempGlobal.data = data;

      // specify options
      var options = {
        width:  '1024px',
        height: '768px',
        style: 'surface',
        showPerspective: true,
        showGrid: true,
        showShadow: false,
        keepAspectRatio: true,
        verticalRatio: 0.5,
        xLabel: "success states in pop",
        yLabel: "observed successes",
      };

      // Instantiate our graph object.
      const container = document.createElement('div');
      root.appendChild(container);
      tempGlobal.graph = new vis.Graph3d(container, tempGlobal.data, options);
    } else {
      tempGlobal.data = data;
      tempGlobal.graph.setData(tempGlobal.data);
    }

    //
    // Render table
    //

    const container = document.createElement('div');

    const entryTable = document.createElement("table");

    const headerRow = document.createElement("tr");

    const successesInPopH = document.createElement("th");
    successesInPopH.textContent = "successesInPop";
    headerRow.appendChild(successesInPopH);

    const observedSuccessesH = document.createElement("th");
    observedSuccessesH.textContent = "observedSuccesses";
    headerRow.appendChild(observedSuccessesH);

    const probabilityH = document.createElement("th");
    probabilityH.textContent = "probability";
    headerRow.appendChild(probabilityH);

    entryTable.appendChild(headerRow);

    for (let i = 0; i < rows.length; i += 1) {
        const {successesInPop, observedSuccesses, probability} = rows[i];
        const dataRow = document.createElement("tr");

        const successesInPopD = document.createElement("td");
        successesInPopD.textContent = successesInPop;
        dataRow.appendChild(successesInPopD);

        const observedSuccessesD = document.createElement("td");
        observedSuccessesD.textContent = observedSuccesses;
        dataRow.appendChild(observedSuccessesD);

        const probabilityD = document.createElement("td");
        const pString = probability.toFixed(8);
        probabilityD.textContent = probability === 0 ? "0" : pString === "0.00000000" ? "0.000000+Îµ" : pString;
        dataRow.appendChild(probabilityD);

        entryTable.appendChild(dataRow);
    }

    container.appendChild(entryTable);

    root.appendChild(container);
  };

  root = document.getElementById("root");

  var axisStep = 1;

  const popMax = 60;
  const draws = 7;

  const rows = [];

  for (var successesInPop = 0; successesInPop <= popMax; successesInPop += axisStep) {
    for (var observedSuccesses = 0; observedSuccesses <= draws; observedSuccesses += axisStep) {
      const probability = Hypergeometric.pmf(popMax, successesInPop, draws, observedSuccesses);
      rows.push({successesInPop, observedSuccesses, probability});
    }
  }

  renderGraph({rows, yMax: draws});
</script>

</html>
